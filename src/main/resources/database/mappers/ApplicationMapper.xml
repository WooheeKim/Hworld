<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.hworld.base.dao.ApplicationDAO">
	
	<!-- 신청서 테이블에 insert -->
	<!-- 'auto-increment로 발생한 수를 num에 넣어주세요' 라는 의미 -->
	<!-- useGenerateKeys를 사용하고, 해당 옵션으로 생성된 값을 넣을 변수명을 keyProperty에 입력해준다. 값이 생성되었으므로 아래의 쿼리문을 사용한다. -->
	<insert id="setFormAdd" parameterType="ApplicationVO" useGeneratedKeys="true" keyProperty="appNum">
		INSERT INTO APPLICATIONFORM2(APPNUM, NAME, RRNF, RRNL, ADDRESS1, ADDRESS2, ADDRESS3, PLANNUM, PHONENUM, DISKIND, PHONESUBPRICE, STARTDATE, DIRECTNAME)
		VALUES(#{appNum}, #{name}, #{rrnf}, #{rrnl}, #{address1}, #{address2}, #{address3}, #{planNum}, #{phoneNum}, #{disKind}, 0, NOW(), #{directName})
	</insert>
	
	<!-- 신청서VO의 주민번호와 회원 테이블의 주민번호가 일치하는 정보가 있는지 확인 -->
	<select id="getMemberSearch" parameterType="ApplicationVO" resultType="MemberVO">
		SELECT MEMBERNUM FROM MEMBER
		WHERE RRNF = #{rrnf} AND RRNL = #{rrnl}
	</select>
	
	<!-- 신청서VO 기반 회원에 정보 입력 -->
	<!-- MEMBERSTATE -1:휴면, 0:일시정지, 1:정상, 2:탈퇴 / ADMINCHECK 0:ADMIN, 1:MEMBER -->
	<insert id="setMemberInitAdd" parameterType="ApplicationVO">
		INSERT INTO MEMBER(MEMBERNUM, EMAIL, PW, NAME, ADDRESS1, ADDRESS2, ADDRESS3, RRNF, RRNL, JOINDATE, NUMBERCHANGEDATE, MEMBERSTATE, ADMINCHECK, PHONENUM, OWNCHECK, SALT)
		VALUES(NULL, NULL, NULL, #{name}, #{address1}, #{address2}, #{address3}, #{rrnf}, #{rrnl}, NOW(), NULL, '1', '1', #{phoneNum}, '1', NULL)
	</insert>
	
	<!-- 신청서VO 기반 회선에 정보 입력 -->
	<!-- 파라미터가 다른 정보들은 이어서 update -->
	<insert id="setTelephoneInitAdd" parameterType="ApplicationVO" useGeneratedKeys="true" keyProperty="serialNum">
		INSERT INTO TELEPHONE(SERIALNUM, PLANNUM, MEMBERNUM, APPNUM, PHONENUM, CONTRACTDATE, EXPIREDATE, DIRECTNAME, ENDDATE, KINGCHECK, PHONEORIPRICE, PHONESUBPRICE, PHONETOTALPRICE, PHONEBALANCE, STOPSTARTDATE, STOPENDDATE, DISKIND)
		VALUES(#{serialNum}, #{planNum}, NULL, #{appNum}, #{phoneNum}, NULL, NULL, #{directName}, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL. #{disKind})
	</insert>
	
	<!-- MEMBERNUM update -->
	<update id="setTelephoneInitUpdate" parameterType="MemberVO">
		UPDATE TELEPHONE SET MEMBERNUM=#{memberNum}
		WHERE SERIALNUM=#{serialNum}
	</update>
	

</mapper>